<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <link rel="stylesheet" type="text/css" href="css/reset.css">
  <link rel="stylesheet" type="text/css" href="css/toast.css">
  <style type="text/css">
    .register {
      margin: 100px;
      width: 500px;
      text-align: right;
    }
    .register label {
      display: block;
      margin: 3px 0;
    }
    .register .bd span {
      padding: 0 5px 0 0;
    }
    .showAddress {
      padding: 20px 300px;
      margin: 0 auto;
      border-top: 1px solid #333;
      border-bottom: 1px solid #333;
    }
    .showAddress table {
      border-collapse: collapse;
      border: 1px solid #333;
    }
    .showAddress table td {
      border: 1px solid #333;
    }
  </style>
</head>
<body>
  <div class="register">
    <div class="container">
      <div class="hd">添加收货地址</div>
      <div class="bd">
        <form>
          <label>
            <span>地址名称</span> <input type="text" name="address_name" value="家">
          </label>
          <label>
            <span>收货人</span> <input type="text" name="consignee" value="maxwelldu">
          </label>
          <label>
            <span>国家</span> <input type="text" name="country" value="中国">
          </label>
          <label>
            <span>省</span> <input type="text" name="province" value="北京">
          </label>
          <label>
            <span>市</span> <input type="text" name="city" value="北京">
          </label>
          <label>
            <span>区</span> <input type="text" name="district" value="石景山">
          </label>
          <label>
            <span>地址</span> <input type="text" name="address" value="实兴东街11号朗诚大厦南楼二层">
          </label>
          <label>
            <span>邮编</span> <input type="text" name="zip_code" value="100000">
          </label>
          <label>
            <span>手机号</span> <input type="text" name="mobile" value="18518368050">
          </label>
          <label>
            <span>邮箱</span> <input type="text" name="email" value="dcj3sjt@126.com">
          </label>
          <label>
            <span>电话</span> <input type="text" name="tel" value="010-91519281">
          </label>
          <label>
            <span>最佳送货时间</span> <input type="text" name="besttime" value="周一到周五">
          </label>
          <label>
            <span>标志物</span> <input type="text" name="sign_building" value="">
          </label>
          <label>
            <input type="button" value="添加" class="add" id="addAddress">
          </label>
        </form>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="js/myajax.js"></script>
  <script type="text/javascript" src="js/toast.js"></script>
  <script type="text/javascript">
  if(!localStorage.token) {
    location.href = "login.html"
  }
  var oAdd = document.querySelector('#addAddress');
  oAdd.onclick = function() {
    var postobj = serializeForm(document.querySelector('form'));
    myajax.post('http://h6.duchengjiu.top/shop/api_useraddress.php?status=add&token='+localStorage.token,postobj,    function(error,responseText) {
      var json = JSON.parse(responseText);
      console.log(json)
      if(json.code === 0) {
        toast('添加成功',2000);
        showAddress();
      }
    });
  }
  </script>
  <div class="showAddress">
    <table>
      <thead>
        <tr>
          <td>收货人</td>
          <td>所在地区</td>
          <td>详细地址</td>
          <td>邮编</td>
          <td>电话</td>
          <td>操作</td>
        </tr>
      </thead>
      <tbody id="showAddress"></tbody>
      <tfoot></tfoot>
    </table>
  </div>
  <script type="text/javascript">
  var oShowAddress = document.querySelector('#showAddress');
  showAddress();
  function showAddress() {
    myajax.get('http://h6.duchengjiu.top/shop/api_useraddress.php',{token:localStorage.token},function(error,responseText) {
      var json = JSON.parse(responseText);
      var data = json.data;
      oShowAddress.innerHTML = '';
      console.log(data)
      for(var i = 0; i < data.length; i++) {
        var obj = data[i];
        oShowAddress.innerHTML += `
            <tr>
              <td>${obj.consignee}</td>
              <td>${obj.province} ${obj.city} ${obj.district}</td>
              <td>${obj.address}</td>
              <td>${obj.zip_code}</td>
              <td>${obj.mobile}</td>
              <td>
                <a id="change-address" href="javascript:;" data-id="${obj.address_id}">修改</a>
                <a id="delete-address" href="javascript:;" data-id="${obj.address_id}">删除</a>
              </td>
            </tr>
        `
      }
    })
  }
  oShowAddress.onclick = function(e) {
    e = e || window.event;
    target = e.target || e.srcElement;
    var oChangeAddress = document.querySelector('#change-address');
    var oDeleteAddress = document.querySelector('#delete-address');
    if(target.id === 'change-address') {
      console.log(target);
    } else if(target.id = 'delete-address') {

      if(!confirm('确定要删除吗？')) return;
      var address_id = target.dataset.id;
      myajax.get('http://h6.duchengjiu.top/shop/api_useraddress.php',{status:'delete',token:localStorage.token,address_id},
        function(error,responseText) {
        var json = JSON.parse(responseText);
        console.log(json)
        if(json.code === 0) {
          showAddress();
          location.href = "deliver-address.html#showAddress"
        }
      });
    }
  }
  // console.log(oChangeAddress);
  </script>
</body>
</html>