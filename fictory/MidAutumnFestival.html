<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style type="text/css">
    span {
      display: block;
    }
  </style>
</head>
<body>

  <div class="wrap_box">

    <div class="question"></div>
    <div class="answers" data-right="">
    </div>
  </div>

  <a class="btn" href="javascript:;" data-type="sub">上一题</a>
  <a class="btn" href="javascript:;" data-type="add">下一题</a>
  <script type="text/javascript" src="js/jquery-1.12.3.min.js"></script>
  <script type="text/javascript" src="js/underscore.js"></script>

  <script type="text/javascript">
    var templateString = `
      <span data-select="A"><%=A%></span>
      <span data-select="B"><%=B%></span>
      <span data-select="C"><%=C%></span>
      <span data-select="D"><%=D%></span>
    `;
    var compileFunction = _.template(templateString);

    var questionNumber;

    var index = 0;

    var rightNumber = 0;

    loadQuestion(index);

    function loadQuestion(index) {

      $.get('json/json.txt',function(json) {

        var json = eval('(' + json +')');

        var data = json.data;

        for(var i = 0; i < data.length; i++ ) {
          questionNumber = i;
        }

        $('.question').html(data[index].question)

        $('.answers').html(compileFunction(data[index].answers));

        // console.log(data[index].answers);
        // console.log(questionNumber)
      })
    }

    $('.answers').click(function(e) {

      var e = e || window.event;

      var target = e.target || e.srcElement;

      if(target.nodeName === 'SPAN') {

        $.get('json/json.txt',function(json) {

          var json = eval('(' + json +')');

          var data = json.data;

          if($(target).data('select') === data[index].right) {
            // alert('right');
            rightNumber++;

            $(target).css({
              'color':'green'
            });

            index = Math.min(questionNumber, ++index)

            loadQuestion(index);
          } else {
            $(target).css({
              'color':'red'
            })
          }

          if(index === questionNumber) {

            if(rightNumber / questionNumber > 0.6) {
              console.log(rightNumber);
              $('.wrap_box').html('恭喜您答对了' + rightNumber + '道题')
            } else {
              $('.wrap_box').html('很遗憾你答对了' + rightNumber + '道题')
            }
          }
        })
      }
    })

    $('.btn').click(function() {
      if($(this).data('type') === 'add') {
        // console.log(1);
        index++;
        loadQuestion(index);
      }
    })

    $('.btn').click(function() {
      if($(this).data('type') === 'sub') {
        // console.log(1);
        index--;
        loadQuestion(index);
      }
    })
  </script>
</body>
</html>